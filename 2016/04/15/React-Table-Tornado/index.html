<!DOCTYPE HTML>
<html>
<head>
<a href="https://github.com/ChihChengYang" target="_blank">
<img style="position: absolute; top: 0; left: 0; border: 0;" src="https://s3.amazonaws.com/github/ribbons/forkme_left_white_ffffff.png" alt="Fork me on GitHub">
</a>
  <meta charset="utf-8">
  
  <title>React.js work with Tornado | Jeff Yang</title>
  <meta name="author" content="Jeff Yang">
  
  <meta name="description" content="c golang docker mysql">
  
  
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

  <meta property="og:title" content="React.js work with Tornado"/>
  <meta property="og:site_name" content="Jeff Yang"/>

  
    <meta property="og:image" content="undefined"/>
  

  <link href="/favicon.png" rel="icon">
  <link rel="alternate" href="/atom.xml" title="Jeff Yang" type="application/atom+xml">
  <link rel="stylesheet" href="/css/style.css" media="screen" type="text/css">
  <!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->
  

</head>


<body>
  <header id="header" class="inner"><div class="alignleft">
  <h1><a href="/">Jeff Yang</a></h1>
  <h2><a href="/">Enjoy my coding life</a></h2>
</div>
<nav id="main-nav" class="alignright">
  <ul>
    
      <li><a href="/">Home</a></li>
    
      <li><a href="/archives">Archives</a></li>
    
  </ul>
  <div class="clearfix"></div>
</nav>
<div class="clearfix"></div>
</header>
  <div id="content" class="inner">
    <div id="main-col" class="alignleft"><div id="wrapper"><article class="post">
  
  <div class="post-content">
    <header>
      
        <div class="icon"></div>
        <time datetime="2016-04-15T10:40:12.000Z"><a href="/2016/04/15/React-Table-Tornado/">2016-04-15</a></time>
      
      
  
    <h1 class="title">React.js work with Tornado</h1>
  

    </header>
    <div class="entry">
      
        <p><em>React work with tornado.</em></p>
<p>I would like to understand how React.js work, so just try to do it…</p>
<p>Based on Ubuntu 14.04 64bit<br>Prerequisite : <a href="https://nodejs.org/en/" title="node.js" target="_blank" rel="external">node.js</a>,  <a href="https://github.com/webpack/webpack" title="webpack" target="_blank" rel="external">webpack</a>, <a href="http://www.tornadoweb.org/en/stable/" title="tornado" target="_blank" rel="external">tornado</a>, <a href="https://facebook.github.io/fixed-data-table/" title="fixed-data-table" target="_blank" rel="external">fixed-data-table</a>.</p>
<h2 id="Flow"><a href="#Flow" class="headerlink" title="Flow"></a>Flow</h2><p>Run Tornado -&gt; regularly get XML data from another website -&gt; display with React</p>
<h2 id="Install"><a href="#Install" class="headerlink" title="Install"></a>Install</h2><ol>
<li>mkdir react-table &amp;&amp; cd react-table</li>
<li>npm init</li>
<li>npm install webpack –save-dev</li>
<li>npm install babel-loader babel-core babel-preset-es2015 babel-preset-react –save-dev</li>
<li>ln -s /usr/bin/nodejs /usr/bin/node</li>
<li>npm install –save react</li>
<li>npm install –save react-dom</li>
<li>npm install webpack-dev-server –save-dev</li>
<li>npm install fixed-data-table –save</li>
<li>npm install css-loader style-loader –save-dev</li>
</ol>
<h2 id="React_part"><a href="#React_part" class="headerlink" title="React part"></a>React part</h2><p>touch <strong> webpack.config.js </strong></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* webpack.config.js */</span></span><br><span class="line"><span class="keyword">var</span> path = <span class="built_in">require</span>(<span class="string">'path'</span>);</span><br><span class="line"><span class="keyword">var</span> webpack = <span class="built_in">require</span>(<span class="string">'webpack'</span>);</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  context: __dirname + <span class="string">"/src"</span>,</span><br><span class="line">  entry: <span class="string">"./app.js"</span>,</span><br><span class="line">  output: &#123;</span><br><span class="line">    filename: <span class="string">"app.js"</span>,</span><br><span class="line">    path: __dirname + <span class="string">"/dist"</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="built_in">module</span>: &#123;</span><br><span class="line">    loaders: [</span><br><span class="line">        &#123;</span><br><span class="line">          test: <span class="regexp">/\.jsx?$/</span>,</span><br><span class="line">          include: [</span><br><span class="line">            __dirname + <span class="string">"/src"</span></span><br><span class="line">          ],</span><br><span class="line">          exclude: <span class="regexp">/node_modules/</span>,</span><br><span class="line">          loader: <span class="string">'babel'</span>,</span><br><span class="line">           query: &#123;</span><br><span class="line">            presets: [<span class="string">'react'</span>, <span class="string">'es2015'</span>]</span><br><span class="line">           &#125;</span><br><span class="line">        &#125;, &#123; test: <span class="regexp">/\.css$/</span>, loader: <span class="string">'style-loader!css-loader'</span> &#125;,</span><br><span class="line">    ]</span><br><span class="line">   &#125;,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>  
<p>touch <strong> myTable.js </strong></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* myTable.js */</span></span><br><span class="line"><span class="pi">"use strict"</span>;</span><br><span class="line"><span class="keyword">var</span> FakeObjectDataListStore = <span class="built_in">require</span>(<span class="string">'./dataListStore'</span>);</span><br><span class="line"><span class="keyword">var</span> FixedDataTable = <span class="built_in">require</span>(<span class="string">'fixed-data-table'</span>);</span><br><span class="line"><span class="keyword">var</span> React = <span class="built_in">require</span>(<span class="string">'react'</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> &#123;Table, Column, Cell&#125; = FixedDataTable; </span><br><span class="line"><span class="keyword">const</span> TextCell = (&#123;rowIndex, data, col, ...props&#125;) =&gt; (</span><br><span class="line">  <span class="xml"><span class="tag">&lt;<span class="title">Cell</span> &#123;<span class="attribute">...props</span>&#125;&gt;</span></span><br><span class="line">    &#123;data.getObjectAt(rowIndex)[col]&#125;</span><br><span class="line">  <span class="tag">&lt;/<span class="title">Cell</span>&gt;</span></span><br><span class="line">)</span>;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyLinkCell</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</span><br><span class="line">  render() &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123;rowIndex, data, col, ...props&#125; = <span class="keyword">this</span>.props;</span><br><span class="line">    <span class="keyword">const</span> link = data.getObjectAt(rowIndex)[col];</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      <span class="xml"><span class="tag">&lt;<span class="title">Cell</span> &#123;<span class="attribute">...props</span>&#125;&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="title">a</span> <span class="attribute">href</span>=<span class="value">&#123;link&#125;</span>&gt;</span>&#123;link&#125;<span class="tag">&lt;/<span class="title">a</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="title">Cell</span>&gt;</span></span><br><span class="line">    )</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">DataListWrapper</span> </span>&#123;</span><br><span class="line">  constructor(indexMap, data) &#123;</span><br><span class="line">    <span class="keyword">this</span>._indexMap = indexMap;</span><br><span class="line">    <span class="keyword">this</span>._data = data;</span><br><span class="line">  &#125;</span><br><span class="line">  getSize() &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">this</span>._indexMap.length;</span><br><span class="line">  &#125;</span><br><span class="line">  getObjectAt(index) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">this</span>._data.getObjectAt(</span><br><span class="line">      <span class="keyword">this</span>._indexMap[index]</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyTable</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</span><br><span class="line">  constructor(props) &#123;</span><br><span class="line">    <span class="keyword">super</span>(props);</span><br><span class="line">    <span class="comment">//=========================</span></span><br><span class="line">    <span class="keyword">var</span> pageData = <span class="built_in">JSON</span>.parse(<span class="built_in">document</span>.getElementById(<span class="string">'page-data'</span>).getAttribute(<span class="string">'data-page'</span>)); </span><br><span class="line">    <span class="comment">//========================</span></span><br><span class="line">    <span class="keyword">this</span>._dataList = <span class="keyword">new</span> FakeObjectDataListStore(pageData);</span><br><span class="line">    <span class="keyword">this</span>.state = &#123;</span><br><span class="line">      filteredDataList: <span class="keyword">this</span>._dataList,</span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="keyword">this</span>._onFilterChange = <span class="keyword">this</span>._onFilterChange.bind(<span class="keyword">this</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  _onFilterChange(e) &#123;</span><br><span class="line">    <span class="keyword">if</span> (!e.target.value) &#123;</span><br><span class="line">      <span class="keyword">this</span>.setState(&#123;</span><br><span class="line">        filteredDataList: <span class="keyword">this</span>._dataList,</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125; </span><br><span class="line">    <span class="keyword">var</span> filterBy = e.target.value;</span><br><span class="line">    <span class="keyword">var</span> size = <span class="keyword">this</span>._dataList.getSize();</span><br><span class="line">    <span class="keyword">var</span> filteredIndexes = [];</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">var</span> index = <span class="number">0</span>; index &lt; size; index++) &#123;</span><br><span class="line">      <span class="keyword">var</span> &#123;TITLE&#125; = <span class="keyword">this</span>._dataList.getObjectAt(index); </span><br><span class="line">      <span class="keyword">if</span> (TITLE.indexOf(filterBy) !== -<span class="number">1</span>)&#123;</span><br><span class="line">        filteredIndexes.push(index);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">this</span>.setState(&#123;</span><br><span class="line">      filteredDataList: <span class="keyword">new</span> DataListWrapper(filteredIndexes, <span class="keyword">this</span>._dataList),</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line">  render() &#123;</span><br><span class="line">    <span class="keyword">var</span> &#123;filteredDataList&#125; = <span class="keyword">this</span>.state;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      <span class="xml"><span class="tag">&lt;<span class="title">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="title">input</span></span><br><span class="line">          <span class="attribute">onChange</span>=<span class="value">&#123;this._onFilterChange&#125;</span></span><br><span class="line">          <span class="attribute">placeholder</span>=<span class="value">"Filter by 職稱"</span></span><br><span class="line">        /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="title">br</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="title">Table</span></span><br><span class="line">          <span class="attribute">rowHeight</span>=<span class="value">&#123;50&#125;</span></span><br><span class="line">          <span class="attribute">rowsCount</span>=<span class="value">&#123;filteredDataList.getSize()&#125;</span></span><br><span class="line">          <span class="attribute">headerHeight</span>=<span class="value">&#123;50&#125;</span></span><br><span class="line">          <span class="attribute">width</span>=<span class="value">&#123;1000&#125;</span></span><br><span class="line">          <span class="attribute">height</span>=<span class="value">&#123;500&#125;</span></span><br><span class="line">          &#123;<span class="attribute">...this.props</span>&#125;&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="title">Column</span></span><br><span class="line">            <span class="attribute">header</span>=<span class="value">&#123;&lt;Cell</span>&gt;</span>職稱<span class="tag">&lt;/<span class="title">Cell</span>&gt;</span>&#125;</span><br><span class="line">            cell=&#123;<span class="tag">&lt;<span class="title">TextCell</span> <span class="attribute">data</span>=<span class="value">&#123;filteredDataList&#125;</span> <span class="attribute">col</span>=<span class="value">"TITLE"</span> /&gt;</span>&#125;</span><br><span class="line">            fixed=&#123;true&#125;</span><br><span class="line">            width=&#123;100&#125;</span><br><span class="line">          /&gt;</span><br><span class="line">          <span class="tag">&lt;<span class="title">Column</span></span><br><span class="line">            <span class="attribute">header</span>=<span class="value">&#123;&lt;Cell</span>&gt;</span>用人單位<span class="tag">&lt;/<span class="title">Cell</span>&gt;</span>&#125;</span><br><span class="line">            cell=&#123;<span class="tag">&lt;<span class="title">TextCell</span> <span class="attribute">data</span>=<span class="value">&#123;filteredDataList&#125;</span> <span class="attribute">col</span>=<span class="value">"ORG_NAME"</span> /&gt;</span>&#125;</span><br><span class="line">            fixed=&#123;true&#125;</span><br><span class="line">            width=&#123;100&#125;</span><br><span class="line">          /&gt;</span><br><span class="line">          <span class="tag">&lt;<span class="title">Column</span></span><br><span class="line">            <span class="attribute">header</span>=<span class="value">&#123;&lt;Cell</span>&gt;</span>工作區域<span class="tag">&lt;/<span class="title">Cell</span>&gt;</span>&#125;</span><br><span class="line">            cell=&#123;<span class="tag">&lt;<span class="title">TextCell</span> <span class="attribute">data</span>=<span class="value">&#123;filteredDataList&#125;</span> <span class="attribute">col</span>=<span class="value">"WORK_PLACE_TYPE"</span> /&gt;</span>&#125;</span><br><span class="line">            width=&#123;100&#125;</span><br><span class="line">          /&gt;</span><br><span class="line">          <span class="tag">&lt;<span class="title">Column</span></span><br><span class="line">            <span class="attribute">header</span>=<span class="value">&#123;&lt;Cell</span>&gt;</span>人員區分<span class="tag">&lt;/<span class="title">Cell</span>&gt;</span>&#125;</span><br><span class="line">            cell=&#123;<span class="tag">&lt;<span class="title">TextCell</span> <span class="attribute">data</span>=<span class="value">&#123;filteredDataList&#125;</span> <span class="attribute">col</span>=<span class="value">"GENDER_TYPE"</span> /&gt;</span>&#125;</span><br><span class="line">            width=&#123;100&#125;</span><br><span class="line">          /&gt;</span><br><span class="line">          <span class="tag">&lt;<span class="title">Column</span></span><br><span class="line">            <span class="attribute">header</span>=<span class="value">&#123;&lt;Cell</span>&gt;</span>開始日<span class="tag">&lt;/<span class="title">Cell</span>&gt;</span>&#125;</span><br><span class="line">            cell=&#123;<span class="tag">&lt;<span class="title">TextCell</span> <span class="attribute">data</span>=<span class="value">&#123;filteredDataList&#125;</span> <span class="attribute">col</span>=<span class="value">"DATE_FROM"</span> /&gt;</span>&#125;</span><br><span class="line">            width=&#123;100&#125;</span><br><span class="line">          /&gt;</span><br><span class="line">          <span class="tag">&lt;<span class="title">Column</span></span><br><span class="line">            <span class="attribute">header</span>=<span class="value">&#123;&lt;Cell</span>&gt;</span>結束日<span class="tag">&lt;/<span class="title">Cell</span>&gt;</span>&#125;</span><br><span class="line">            cell=&#123;<span class="tag">&lt;<span class="title">TextCell</span> <span class="attribute">data</span>=<span class="value">&#123;filteredDataList&#125;</span> <span class="attribute">col</span>=<span class="value">"DATE_TO"</span> /&gt;</span>&#125;</span><br><span class="line">            width=&#123;100&#125;</span><br><span class="line">          /&gt;          </span><br><span class="line">          <span class="tag">&lt;<span class="title">Column</span></span><br><span class="line">            <span class="attribute">header</span>=<span class="value">&#123;&lt;Cell</span>&gt;</span>網址<span class="tag">&lt;/<span class="title">Cell</span>&gt;</span>&#125;</span><br><span class="line">            cell=&#123;<span class="tag">&lt;<span class="title">MyLinkCell</span> <span class="attribute">data</span>=<span class="value">&#123;filteredDataList&#125;</span> <span class="attribute">col</span>=<span class="value">"VIEW_URL"</span> /&gt;</span>&#125;</span><br><span class="line">            width=&#123;400&#125;         </span><br><span class="line">          /&gt;</span><br><span class="line">        <span class="tag">&lt;/<span class="title">Table</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="title">div</span>&gt;</span></span><br><span class="line">    )</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">module</span>.exports = MyTable;</span><br></pre></td></tr></table></figure>
<p>touch <strong> dataListStore.js </strong></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* dataListStore.js */</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">dataListStore</span> </span>&#123;</span><br><span class="line">  constructor( rows )&#123;</span><br><span class="line">    <span class="keyword">this</span>.size =  rows.length;  </span><br><span class="line">    <span class="keyword">this</span>._cache = rows;  </span><br><span class="line">  &#125;  </span><br><span class="line">  getObjectAt(<span class="comment">/*number*/</span> index) <span class="comment">/*?object*/</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (index &lt; <span class="number">0</span> || index &gt; <span class="keyword">this</span>.size)&#123;</span><br><span class="line">      <span class="built_in">console</span>.log(<span class="string">'_QQca -&gt; '</span>,<span class="keyword">this</span>._cache[index],index);</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">undefined</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">this</span>._cache[index] === <span class="literal">undefined</span>) &#123;</span><br><span class="line">       <span class="built_in">console</span>.log(<span class="string">'_cache undefined!!!!! '</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">this</span>._cache[index];</span><br><span class="line">  &#125; </span><br><span class="line">  getAll() &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">this</span>._cache.length &lt; <span class="keyword">this</span>.size) &#123;</span><br><span class="line">      <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; <span class="keyword">this</span>.size; i++) &#123;</span><br><span class="line">        <span class="keyword">this</span>.getObjectAt(i);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">this</span>._cache.slice();</span><br><span class="line">  &#125;</span><br><span class="line">  getSize() &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">this</span>.size;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">module</span>.exports = dataListStore;</span><br></pre></td></tr></table></figure>
<p>touch <strong> app.js </strong><br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* app.js */</span></span><br><span class="line"><span class="keyword">import</span> MyTable <span class="keyword">from</span> <span class="string">'./myTable'</span></span><br><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">'react'</span></span><br><span class="line"><span class="keyword">import</span> ReactDOM <span class="keyword">from</span> <span class="string">'react-dom'</span></span><br><span class="line"> </span><br><span class="line">ReactDOM.render(&lt;MyTable /&gt;,document.getElementById(<span class="string">'example'</span>));</span><br></pre></td></tr></table></figure> </p>
<p><strong> run webpack </strong><br>root@ubuntu:/home/jeff/react-table# webpack</p>
<p><strong> copy app.js to Tornado part </strong><br>root@ubuntu:/home/jeff/react-table# mkdir -p ../react-tornado/static/js &amp;&amp; mkdir ../react-tornado/static/css &amp;&amp; mkdir -p ../react-tornado/templates<br>root@ubuntu:/home/jeff/react-table# cp fixed-data-table.css ../react-tornado/static/css/<br>root@ubuntu:/home/jeff/react-table# cp ./dist/app.js ../react-tornado/static/js/</p>
<h2 id="Tornado_part"><a href="#Tornado_part" class="headerlink" title="Tornado part"></a>Tornado part</h2><p>/react-tornado </p>
<p>touch <strong> /react-tornado/templates/index.html </strong></p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="doctype">&lt;!doctype html&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">html</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="title">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="title">meta</span> <span class="attribute">charset</span>=<span class="value">"UTF-8"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="title">title</span>&gt;</span>Govjobs<span class="tag">&lt;/<span class="title">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="title">link</span> <span class="attribute">href</span>=<span class="value">"/static/css/fixed-data-table.css"</span></span><br><span class="line">          <span class="attribute">rel</span>=<span class="value">"stylesheet"</span>&gt;</span> </span><br><span class="line">  <span class="tag">&lt;/<span class="title">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="title">body</span> <span class="attribute">style</span>=<span class="value">"font-family:arial;font-size:12px; background:#e1e1e1"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="title">p</span>&gt;</span><span class="tag">&lt;/<span class="title">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="title">div</span> <span class="attribute">id</span>=<span class="value">"example"</span>&gt;</span><span class="tag">&lt;/<span class="title">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="title">div</span> <span class="attribute">id</span>=<span class="value">"page-data"</span> <span class="attribute">data-page</span>=<span class="value">""</span>&gt;</span><span class="tag">&lt;/<span class="title">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="title">script</span> <span class="attribute">src</span>=<span class="value">"/static/js/app.js"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="title">script</span>&gt;</span> </span><br><span class="line">  <span class="tag">&lt;/<span class="title">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="title">html</span>&gt;</span></span><br></pre></td></tr></table></figure> 
<p>touch <strong> /react-tornado/main.py  </strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># main.py</span></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="keyword">import</span> os,json, time, datetime</span><br><span class="line"><span class="keyword">import</span> tornado.httpserver </span><br><span class="line"><span class="keyword">import</span> tornado.options </span><br><span class="line"><span class="keyword">from</span> tornado <span class="keyword">import</span> gen</span><br><span class="line"><span class="keyword">from</span> tornado <span class="keyword">import</span> web, ioloop, websocket</span><br><span class="line"><span class="comment">### </span></span><br><span class="line"><span class="keyword">import</span> xml.etree.cElementTree <span class="keyword">as</span> ET</span><br><span class="line"><span class="keyword">from</span> apscheduler.schedulers.background <span class="keyword">import</span> BackgroundScheduler</span><br><span class="line"><span class="keyword">import</span> urllib3</span><br><span class="line"><span class="comment">###</span></span><br><span class="line"> </span><br><span class="line">settings = &#123;</span><br><span class="line">    <span class="string">"static_path"</span>: os.path.join(os.path.dirname(__file__), <span class="string">"static"</span>),</span><br><span class="line">    <span class="string">"template_path"</span>: os.path.join(os.path.dirname(__file__), <span class="string">"templates"</span>),</span><br><span class="line">    <span class="string">"autoreload"</span>: <span class="keyword">True</span></span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">graphHandler</span><span class="params">(tornado.web.RequestHandler)</span>:</span></span><br><span class="line"><span class="decorator">    @gen.coroutine </span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">i</span><span class="params">(self)</span>:</span> </span><br><span class="line">        <span class="keyword">return</span> self.loadData()     </span><br><span class="line"><span class="decorator">    @gen.coroutine</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get</span><span class="params">(self)</span>:</span></span><br><span class="line">        response, announceDate = <span class="keyword">yield</span> self.i()               </span><br><span class="line">        self.render(<span class="string">"index.html"</span>, a=response,b=announceDate)   </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">loadData</span><span class="params">(self)</span>:</span>   </span><br><span class="line">        <span class="comment">#saveData()</span></span><br><span class="line">        module_dir = os.path.dirname(__file__)</span><br><span class="line">        file_path = os.path.join(module_dir, <span class="string">'export.xml'</span>)</span><br><span class="line">        A=[]</span><br><span class="line">        tree = ET.parse(file_path)</span><br><span class="line">        root = tree.getroot()  </span><br><span class="line">        ANNOUNCE_DATE = root.find(<span class="string">'ANNOUNCE_DATE'</span>).text</span><br><span class="line">        <span class="keyword">for</span> country <span class="keyword">in</span> root.findall(<span class="string">'ROW'</span>):</span><br><span class="line">            A.append(&#123;</span><br><span class="line">                <span class="string">'TITLE'</span> : country.find(<span class="string">'TITLE'</span>).text,</span><br><span class="line">                <span class="string">'ORG_NAME'</span> : country.find(<span class="string">'ORG_NAME'</span>).text,</span><br><span class="line">                <span class="string">'WORK_PLACE_TYPE'</span> : country.find(<span class="string">'WORK_PLACE_TYPE'</span>).text,</span><br><span class="line">                <span class="string">'GENDER_TYPE'</span> : country.find(<span class="string">'GENDER_TYPE'</span>).text,                    </span><br><span class="line">                <span class="string">'DATE_FROM'</span> : country.find(<span class="string">'DATE_FROM'</span>).text,</span><br><span class="line">                <span class="string">'DATE_TO'</span> : country.find(<span class="string">'DATE_TO'</span>).text,</span><br><span class="line">                <span class="string">'VIEW_URL'</span> : country.find(<span class="string">'VIEW_URL'</span>).text            </span><br><span class="line">        &#125;) </span><br><span class="line">        <span class="keyword">return</span> json.dumps(A, ensure_ascii=<span class="keyword">False</span>),ANNOUNCE_DATE</span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">saveData</span><span class="params">()</span>:</span> </span><br><span class="line">    http = urllib3.PoolManager() </span><br><span class="line">    r = http.request(<span class="string">'GET'</span>, <span class="string">'http://web3.dgpa.gov.tw//WANT03FRONT//AP//WANTF00003.aspx?GETJOB=Y'</span>)</span><br><span class="line">    <span class="keyword">if</span> r.status == <span class="number">200</span>:</span><br><span class="line">        module_dir = os.path.dirname(__file__)</span><br><span class="line">        file_path = os.path.join(module_dir, <span class="string">'export.xml'</span>)</span><br><span class="line">        <span class="keyword">with</span> open(file_path, <span class="string">"wb"</span>) <span class="keyword">as</span> code:     </span><br><span class="line">            code.write(r.data)   </span><br><span class="line"></span><br><span class="line">sched = BackgroundScheduler()</span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">scheduled_job</span><span class="params">()</span>:</span></span><br><span class="line">    saveData()</span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">main</span><span class="params">()</span>:</span>     </span><br><span class="line">    application = tornado.web.Application([</span><br><span class="line">        (<span class="string">r"/"</span>, graphHandler) </span><br><span class="line">    ], **settings)</span><br><span class="line"></span><br><span class="line">    http_server = tornado.httpserver.HTTPServer(application)</span><br><span class="line">    port = int(os.environ.get(<span class="string">"PORT"</span>, <span class="number">5000</span>))</span><br><span class="line">    http_server.listen(port) </span><br><span class="line">	</span><br><span class="line">	sched.add_job(scheduled_job, <span class="string">'cron'</span>, day_of_week=<span class="string">'mon-fri'</span>, hour=<span class="number">18</span>, minute=<span class="number">00</span>)</span><br><span class="line">    sched.start()</span><br><span class="line">	</span><br><span class="line">    tornado.ioloop.IOLoop.instance().start()</span><br><span class="line">     </span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">"__main__"</span>:</span><br><span class="line">    main()</span><br></pre></td></tr></table></figure> 
<p><strong> Run </strong><br>python main.py</p>
<h2 id="Demo"><a href="#Demo" class="headerlink" title="Demo"></a>Demo</h2><p><strong> There are troubles to get data regularly on heroku has some limits on http request and the file save… </strong></p>
<p><a href="https://govjobs.herokuapp.com/" target="_blank" rel="external">https://govjobs.herokuapp.com/</a></p>
<p><strong> Work fine on local </strong></p>
<img src="/2016/04/15/React-Table-Tornado/Screenshot2.png" alt=" show result" title=" show result">    

      
    </div>
    <footer>
      
        
  
  <div class="categories">
    <a href="/categories/Coding/">Coding</a>
  </div>

        
  
  <div class="tags">
    <a href="/tags/javascript/">javascript</a>, <a href="/tags/python/">python</a>, <a href="/tags/react/">react</a>, <a href="/tags/tornado/">tornado</a>
  </div>

        
  <div class="addthis addthis_toolbox addthis_default_style">
    
      <a class="addthis_button_facebook_like" fb:like:layout="button_count"></a>
    
    
      <a class="addthis_button_tweet"></a>
    
    
      <a class="addthis_button_google_plusone" g:plusone:size="medium"></a>
    
    
      <a class="addthis_button_pinterest_pinit" pi:pinit:layout="horizontal"></a>
    
    <a class="addthis_counter addthis_pill_style"></a>
  </div>
  <script type="text/javascript" src="//s7.addthis.com/js/300/addthis_widget.js"></script>

      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>


<section id="comment">
  <h1 class="title">留言</h1>

  
      <div id="fb-root"></div>
<script>
  (function(d, s, id) {
    var js, fjs = d.getElementsByTagName(s)[0];
    if (d.getElementById(id)) return;
    js = d.createElement(s); js.id = id;
    js.src = "//connect.facebook.net/en_US/all.js#xfbml=1&appId=123456789012345";
    fjs.parentNode.insertBefore(js, fjs);
  }(document, 'script', 'facebook-jssdk'));
</script>

<div class="fb-comments" data-href="http://chihchengyang.github.io/2016/04/15/React-Table-Tornado/index.html" data-num-posts="5" data-width="840" data-colorscheme="light"></div>
      
  
</section>

</div></div>
    <aside id="sidebar" class="alignright">
  <div class="search">
  <form action="//google.com/search" method="get" accept-charset="utf-8">
    <input type="search" name="q" results="0" placeholder="搜尋">
    <input type="hidden" name="q" value="site:chihchengyang.github.io">
  </form>
</div>

  
  <div class="widget tag">
    <h3 class="title">Archives</h3>
    <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/06/">2016.06</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/05/">2016.05</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/04/">2016.04</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/03/">2016.03</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/02/">2016.02</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/01/">2016.01</a><span class="archive-list-count">8</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/12/">2015.12</a><span class="archive-list-count">2</span></li></ul>
  </div>


  
<div class="widget tag">
  <h3 class="title">分類</h3>
  <ul class="entry">
  
    <li><a href="/categories/Algorithm/">Algorithm</a><small>1</small></li>
  
    <li><a href="/categories/Coding/">Coding</a><small>13</small></li>
  
    <li><a href="/categories/Machine-Learning/">Machine Learning</a><small>3</small></li>
  
    <li><a href="/categories/Others/">Others</a><small>1</small></li>
  
    <li><a href="/categories/Tools/">Tools</a><small>2</small></li>
  
  </ul>
</div>


  
<div class="widget tag">
  <h3 class="title">標籤</h3>
  <ul class="entry">
  
    <li><a href="/tags/android/">android</a><small>1</small></li>
  
    <li><a href="/tags/c-c/">c/c++</a><small>1</small></li>
  
    <li><a href="/tags/c3-js/">c3.js</a><small>2</small></li>
  
    <li><a href="/tags/django/">django</a><small>1</small></li>
  
    <li><a href="/tags/docker/">docker</a><small>6</small></li>
  
    <li><a href="/tags/golang/">golang</a><small>4</small></li>
  
    <li><a href="/tags/influxDB/">influxDB</a><small>2</small></li>
  
    <li><a href="/tags/ipmi/">ipmi</a><small>1</small></li>
  
    <li><a href="/tags/javascript/">javascript</a><small>5</small></li>
  
    <li><a href="/tags/python/">python</a><small>9</small></li>
  
    <li><a href="/tags/r/">r</a><small>1</small></li>
  
    <li><a href="/tags/react/">react</a><small>1</small></li>
  
    <li><a href="/tags/supervisord/">supervisord</a><small>3</small></li>
  
    <li><a href="/tags/tools/">tools</a><small>3</small></li>
  
    <li><a href="/tags/tornado/">tornado</a><small>2</small></li>
  
    <li><a href="/tags/vm/">vm</a><small>1</small></li>
  
  </ul>
</div>

</aside>
    <div class="clearfix"></div>
  </div>
  <footer id="footer" class="inner"><div class="alignleft">
  
  &copy; 2016 Jeff Yang
  
</div>
<div class="clearfix"></div></footer>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>
<script src="/js/jquery.imagesloaded.min.js"></script>
<script src="/js/gallery.js"></script>




<link rel="stylesheet" href="/fancybox/jquery.fancybox.css" media="screen" type="text/css">
<script src="/fancybox/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
(function($){
  $('.fancybox').fancybox();
})(jQuery);
</script>

</body>
</html>